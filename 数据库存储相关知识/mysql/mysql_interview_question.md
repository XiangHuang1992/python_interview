## 什么是Mysql？

* MySQL提供的所有存储引擎。
``````
mysql> show engines;
+--------------------+---------+----------------------------------------------------------------+--------------+------+------------+
| Engine             | Support | Comment                                                        | Transactions | XA   | Savepoints |
+--------------------+---------+----------------------------------------------------------------+--------------+------+------------+
| InnoDB             | DEFAULT | Supports transactions, row-level locking, and foreign keys     | YES          | YES  | YES        |
| MRG_MYISAM         | YES     | Collection of identical MyISAM tables                          | NO           | NO   | NO         |
| MEMORY             | YES     | Hash based, stored in memory, useful for temporary tables      | NO           | NO   | NO         |
| BLACKHOLE          | YES     | /dev/null storage engine (anything you write to it disappears) | NO           | NO   | NO         |
| MyISAM             | YES     | MyISAM storage engine                                          | NO           | NO   | NO         |
| CSV                | YES     | CSV storage engine                                             | NO           | NO   | NO         |
| ARCHIVE            | YES     | Archive storage engine                                         | NO           | NO   | NO         |
| PERFORMANCE_SCHEMA | YES     | Performance Schema                                             | NO           | NO   | NO         |
| FEDERATED          | NO      | Federated MySQL storage engine                                 | NULL         | NULL | NULL       |
+--------------------+---------+----------------------------------------------------------------+--------------+------+------------+
``````

> MySQL当前默认的存储引擎是InnoDB，并且在5.7版本中所有的存储引擎中只有InnoDB是事务性存储引擎，也就是说只有InnoDB支持事务。


* MyISAM和InnoDB的区别

> MyISAM是MySQL的默认数据库引擎（5.5版本之前），虽然性能极佳，提供了大量的特性，包括全文索引、压缩、空间函数等。但是不支持事务和行级锁，而且最大的缺陷就是崩溃后无法安全恢复。5.5版本之后，MySQL引入了InnoDB(事务性数据库引擎)。
> 是否支持行级锁：MyISAM只有表级锁，而InnoDB支持行级锁和表级锁，默认为行级锁。
> 是否支持事务和崩溃后的安全恢复：MyISAM强调的是性能，每次查询具有原子性，其执行速度比InnoDB类型更快，但是不提供事务。InnoDB支持事务，外键等高级数据库功能。具有事务、回滚、崩溃修复能力和事务安全型表。
> 是否支持外键：MyISAM不支持，InnoDB支持。
> 是否支持MVCC：仅InnoDB支持。应对高并发事务，MVCC比单纯的加锁更高效。

* 索引

MySQL索引使用的数据结构主要有BTree索引和哈希索引。对于哈希索引来说，底层的数据结构就是哈希表，因此在绝大多数需求为单条记录查询的时候，可以选择哈希索引，查询性能最快；其余大部分场景，建议选择BTree索引。

> MyISAM:B+Tree叶结点的data域存放的是数据记录的地址。在索引检查的时候，首先按照B+Tree搜索算法搜索索引，如果指定的Key存在，则取出data域的值，然后以data域的值为地址读取相应的数据记录。这被称为“非聚簇索引”。

> InnoDB: 其数据文件本身就是一个索引结构，相比MyISAM，索引文件和数据文件是分离的，其表数据文件本身就是按B+Tree组织的一个索引结构，树的叶结点data域保存了完整的数据记录。这个索引的key是数据表的主键，因此InnoDB表数据文件本身就是索引。这被称为“聚簇索引”。而其余的索引都作为辅助索引，辅助索引的data域存储相应记录主键的值而不是地址，这也是和MyISAM不同的地方。在根据主索引搜索时，直接找到key所在的节点即可取出数据；在根据辅助索引查找时，则需要先取出主键的值，再走一边主索引。因此，在设计表的时候，不建议使用过长的字段作为主键，也不建议使用非单调的字段作为主键，这样会做成主索引频繁分裂。

* 查询缓存的使用

  > 执行查询语句的时候，会先查询缓存。不过，MySQL 8.0版本后移除，因为这个功能不太实用。
  > 开启缓存查询后在同样的查询条件和数据情况下，会直接在缓存中返回结果。缓存虽然能够提升数据库的查询性能，但是缓存同时也带来了额外的开销，每次查询后都要做一次缓存操作，失效后还要销毁，因此，开启缓存查询要谨慎，尤其对于写密集的应用来说更是如此。如果开启，要注意合理控制缓存空间大小，一般来说其大小设置为几十MB比较合适。此外，还可以通过sql_cache和sql_no_cache来控制某个查询语句是否需要缓存。


### 事务


事务是逻辑上的一组操作，要么都执行，要么都不执行。

#### 事务的四大特性（ACID）

* 原子性：事务是最小的执行单位，不允许分割。事务的原子性确保动作要么全部完成，要么完全不起作用。
* 一致性：执行事务前后，数据保持一只，多个事务对同一个数据读取的结果是相同的。
* 隔离性：并发访问数据库时，一个用户的事务不被其他事务干扰，各并发事务之间数据库是独立的。
* 持久性：一个事务被提交之后。它对数据库中数据的改变是持久的，即使数据库发生故障也不应该对其有任何影响/


#### 并发事务带来哪些问题

在典型对应用程序中，多个事务并发运行，经常会操作相同对数据来完成各自的任务（多个用户对同一数据进行操作）。并发虽然是必须的，但可能会导致以下的问题。

* 脏读：当一个事务正在访问数据并且对数据进行了修改，而这种修改还没有提交到数据库中，这时另外一个事务也访问了这个数据，然后使用了这个数据。因为这个数据是还没有提交的数据，那么另一个事务读到的这个数据是脏数据。依据脏数据所做的操作可能是不正确的。
* 丢失修改：指在一个事务读取一个数据时，另外一个事务也访问了该数据，那么在第一个事务中修改了这个数据后，第二个事务也修改了这个数据。这样第一个事务内修改的结果就被丢失，因此被称为丢失修改。例如：事务1读取某表中的数据A=20，事务2也读取A=20，事务1修改A=A-1，事务2也修改A=A-1，那么最终结果A=19，事务的修改被丢失。
* 不可重复读：只在一个事务内多次读同一数据。在在这个事务还没结束时，另一个事务也访问该数据，那么在第一个事务的两次读数据之间，由于第二个事务的修改导致第一个事务两次读取的数据可能不太一样。这样就发生了在一个事务内两次读到的数据是不一样的情况，因此称为不可重复读。
* 幻读：幻读与不可重复读类似，它发生在一个事务读取了几行数据，接着另一个并发事务插入了一些数据时。在随后的查询中，第一个事务就会发现多了一些原本不存在的记录，就好像发生了幻觉一样，所以称为幻读。



